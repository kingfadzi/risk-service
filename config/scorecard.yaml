version: 2
score_name: "ChangeRiskScore"

# Scorecard scaling parameters
# points0: Base score added to all calculations
scaling:
  points0: 600

# Feature metadata - documents collection method for each feature
# collection: questionnaire | cmdb | git | cicd | derived
feature_metadata:
  data_sensitivity:
    source: questionnaire
    question_id: data_sensitivity
    description: Most sensitive data type handled by application
  downtime_impact:
    source: questionnaire
    question_id: downtime_impact
    description: Business impact of 4-hour outage
  integrity_impact:
    source: questionnaire
    question_id: integrity_impact
    description: Impact of data corruption
  breach_consequence:
    source: questionnaire
    question_id: breach_consequence
    description: Worst-case security breach scenario
  disaster_recovery:
    source: questionnaire
    question_id: disaster_recovery
    description: Required recovery time (RTO)
  system_dependencies:
    source: questionnaire
    question_id: system_dependencies
    description: Number of downstream dependent systems
  regulatory_count:
    source: questionnaire
    question_id: regulatory_context
    description: Count of applicable regulatory frameworks
  resilience_category:
    source: cmdb
    table: spdw_vwsfservice_offering
    column: resiliency_category
    description: CMDB resilience tier (0-3)
  change_size:
    source: git
    description: Size derived from lines changed
  test_depth:
    source: cicd
    description: Test stages passed in pipeline
  apps_sharing_codebase:
    source: derived
    table: component_mapping
    description: Count of apps linked to same repository
  downstream_critical_deps:
    source: derived
    table: spdw_vwsfconfigcirel
    description: Count from dependency graph traversal

# Scorecard bins in scorecardpy-compatible format
scorecard:
  # === QUESTIONNAIRE-BASED FEATURES ===

  # Q1: Data sensitivity (severity 1-5)
  data_sensitivity:
    - bin: "payment_card_data"
      points: 16
    - bin: "regulated_pii"
      points: 12
    - bin: "customer_pii"
      points: 8
    - bin: "internal_business"
      points: 4
    - bin: "public_data"
      points: 0

  # Q2: Downtime impact (severity 1-4)
  downtime_impact:
    - bin: "revenue_loss_critical"
      points: 12
    - bin: "major_disruption"
      points: 8
    - bin: "productivity_impact"
      points: 4
    - bin: "minimal_impact"
      points: 0

  # Q3: Integrity impact (severity 1-4)
  integrity_impact:
    - bin: "financial_harm"
      points: 12
    - bin: "decision_impact"
      points: 8
    - bin: "operational_inefficiency"
      points: 4
    - bin: "low_impact"
      points: 0

  # Q4: Breach consequence (severity 1-5)
  breach_consequence:
    - bin: "payment_exposure"
      points: 16
    - bin: "pii_breach"
      points: 12
    - bin: "customer_data_exposure"
      points: 8
    - bin: "internal_exposure"
      points: 4
    - bin: "public_only"
      points: 0

  # Q5: Disaster recovery RTO (severity 1-4)
  disaster_recovery:
    - bin: "four_hours"
      points: 12
    - bin: "twentyfour_hours"
      points: 8
    - bin: "three_days"
      points: 4
    - bin: "one_week"
      points: 0

  # Q6: System dependencies (severity 1-4)
  system_dependencies:
    - bin: "high_dependency"
      points: 12
    - bin: "moderate_dependency"
      points: 8
    - bin: "low_dependency"
      points: 4
    - bin: "standalone"
      points: 0

  # Q7: Regulatory framework count (0-5)
  regulatory_count:
    - bin: "[-inf,1)"
      points: 0
    - bin: "[1,2)"
      points: 3
    - bin: "[2,3)"
      points: 6
    - bin: "[3,4)"
      points: 8
    - bin: "[4,inf)"
      points: 10

  # === CMDB-BASED FEATURES ===

  # Resilience category from CMDB (0=most critical, 3=least)
  resilience_category:
    - bin: "0"
      points: 12
    - bin: "1"
      points: 8
    - bin: "2"
      points: 4
    - bin: "3"
      points: 0

  # === GIT/CI-BASED FEATURES ===

  # Change size from git diff
  change_size:
    - bin: "XS"
      points: 0
    - bin: "S"
      points: 3
    - bin: "M"
      points: 6
    - bin: "L"
      points: 10
    - bin: "XL"
      points: 14

  # Test depth from CI/CD pipeline
  test_depth:
    - bin: "NONE"
      points: 8
    - bin: "UNIT_ONLY"
      points: 4
    - bin: "UNIT_INTEGRATION"
      points: 0
    - bin: "FULL"
      points: -4
    - bin: "FULL_PLUS_CHAOS"
      points: -8

  # === DERIVED FEATURES ===

  # Apps sharing codebase (from component_mapping)
  apps_sharing_codebase:
    - bin: "[-inf,2)"
      points: 0
    - bin: "[2,4)"
      points: 4
    - bin: "[4,6)"
      points: 8
    - bin: "[6,10)"
      points: 12
    - bin: "[10,inf)"
      points: 16

  # Downstream critical dependencies (from dependency graph)
  downstream_critical_deps:
    - bin: "[-inf,2)"
      points: 0
    - bin: "[2,4)"
      points: 5
    - bin: "[4,8)"
      points: 9
    - bin: "[8,inf)"
      points: 14

# Risk bands based on total score (base 600 + points)
# Max possible: 600 + 140 = 740
# Min possible: 600 - 8 = 592
bands:
  - name: "LOW"
    max_score: 635
  - name: "MEDIUM"
    max_score: 670
  - name: "HIGH"
    max_score: 705
  - name: "CRITICAL"
    max_score: 9999
